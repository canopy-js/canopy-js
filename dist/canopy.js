(()=>{var e={883:e=>{e.exports=function e(t){var n=t.replace(/(^|(?:.?[^\S])+)([_`*~])((?:.*?\S))\2(\W+|$)/,"$1$3$4");return n!==t?e(n):t}},240:(e,t,n)=>{function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(883);n(269);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.display=t,this.mixedCase=a(t).split(/\\\\/g).map((function(e){return e.replace(/\\/g,"")})).join("\\\\"),this.escapedMixedCase=CSS.escape(this.mixedCase),this.slug=this.mixedCase.replace(/%/g,"%25").replace(/\\\\/g,"%5C%5C").replace(/#/g,"%23").replace(/`/g,"%60").replace(/_/g,"%5C_").replace(/ /g,"_"),this.caps=this.mixedCase.toUpperCase().replace(/\?$/,"").replace(/"/g,"").replace(/'/g,"").replace(/_/g," "),this.fileName=this.slug,this.requestFileName=encodeURIComponent(this.slug)}var t,n;return t=e,n=[{key:"fromMixedCase",value:function(t){var n=new e(t=t.replace(/([`_~*])/g,"\\$1"));return n.display=null,n}},{key:"fromEncodedSlug",value:function(t){t=function(e){return e.split(/%5C%5C/g).map((function(e){return e.split(/%5C_/g).map((function(e){return e.replace(/_/g," ")})).join("%5C_")})).join("%5C%5C")}(t);var n=new e(t=(t=decodeURIComponent(t)).replace(/\*/g,"\\*").replace(/`/g,"\\`").replace(/~/g,"\\~"));return n.display=null,n}}],null&&r(t.prototype,null),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();i.convertUnderscoresToSpaces=function(e){return e.split(/%5C%5C/g).map((function(e){return e.split(/%5C_/g).map((function(e){return e.replace(/_/g," ")})).join("%5C_")})).join("%5C%5C")},i.convertSpacesToUnderscores=function(e){return e.split("/").map((function(e){return new i(e).fileName})).join("/")},e.exports=i},570:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(537),a=n.n(r),i=n(645),o=n.n(i)()(a());o.push([e.id,"#_canopy{padding-top:15px;padding-bottom:55px}#_canopy h1{text-align:center;margin:auto;width:40%;margin-top:10px}#_canopy hr{width:120px;display:block;height:1px;border:0;border-top:5px solid #ccc;margin:0px auto;padding-bottom:30px}#_canopy section.canopy-topic-section{padding-top:40px}#_canopy section.canopy-selected-section{padding-bottom:80vh}#_canopy section{padding-top:30px}#_canopy p{overflow:hidden;font-size:22px;max-width:700px;margin:auto;line-height:1.3;letter-spacing:-0.003em;font-weight:400}#_canopy a.canopy-selectable-link{text-decoration:underline #ddd;color:#000;cursor:pointer}#_canopy a.canopy-selectable-link:hover{text-decoration:underline}#_canopy a.canopy-selectable-link:focus{outline:0}#_canopy a.canopy-selectable-link.canopy-open-link{text-shadow:.8px 0px 0px #000;text-decoration:underline}#_canopy a.canopy-selectable-link.canopy-selected-link{background-color:#edeefc;text-shadow:0px 0px 0px #000;text-decoration:none}#_canopy a.canopy-selectable-link.canopy-selected-link:hover{text-decoration:underline}#_canopy a.canopy-selectable-link.canopy-url-link{display:inline}#_canopy a.canopy-selectable-link.canopy-url-link svg{margin-left:2px}#_canopy span.canopy-text-span{display:block}#_canopy hr.canopy-footnote-rule{width:700px;display:block;height:1px;border:0;border-top:1px solid #ccc;margin:12px 0;padding:0}#_canopy sup{font-size:60%;padding:2px}#_canopy .canopy-footnote-span{font-size:80%}#_canopy blockquote{padding:0 .7em;border-left:.25em solid #d3d3d3;color:#565e67;margin-block-start:.5em;margin-block-end:.5em;margin-inline-start:0px;margin-inline-end:0px}#_canopy blockquote a.canopy-selectable-link{text-decoration:underline #d3d3d3}#_canopy pre{margin:10px 10px;background-color:#eff0f1;padding:5px;font-size:85%}#_canopy code{background-color:#eff0f1;font-size:90%}#_canopy table{margin:7px auto;table-layout:fixed;width:70%;border-collapse:collapse;border:2px solid #000}#_canopy table td,#_canopy table th{border:2px solid #000;text-align:center;padding:6px}#_canopy .canopy-image{width:220px;max-height:250px}#_canopy div.canopy-image-div{float:right;border:1px solid #c8ccd1;padding:3px;background-color:#f8f9fa;font-size:94%;text-align:center;overflow:hidden;margin:10px}#_canopy div.canopy-image-div>sup{display:block}#_canopy .canopy-url-link-span>svg{height:15px;width:12px;display:none}#_canopy .canopy-selected-link+svg,#_canopy .canopy-url-link-span:hover>svg{display:inline-block;vertical-align:middle}#_canopy ol,#_canopy ul{margin:7px 10px}#_canopy div.canopy-raw-html{display:inline}#_canopy>section.canopy-topic-section{padding-top:30px}","",{version:3,sources:["webpack://./client/style/canopy.scss"],names:[],mappings:"AAAA,SACE,gBAAA,CACA,mBAAA,CAEA,YACE,iBAAA,CACA,WAAA,CACA,SAAA,CACA,eAAA,CAGF,YACE,WAAA,CACA,aAAA,CACA,UAAA,CACA,QAAA,CACA,yBAAA,CACA,eAAA,CACA,mBAAA,CAGF,sCACE,gBAAA,CAGF,yCAME,mBAAA,CAGF,iBACE,gBAAA,CAGF,WACE,eAAA,CACA,cAAA,CACA,eAAA,CACA,WAAA,CAEA,eAAA,CACA,uBAAA,CACA,eAAA,CAKF,kCACE,8BAAA,CACA,UAAA,CACA,cAAA,CAEA,wCACE,yBAAA,CAGF,wCACE,SAAA,CAGF,mDACE,6BAAA,CACA,yBAAA,CAGF,uDACE,wBAAA,CACA,4BAAA,CACA,oBAAA,CAEA,6DACE,yBAAA,CAcJ,kDACE,cAAA,CAEA,sDACE,eAAA,CAON,+BACE,aAAA,CAGF,iCACE,WAAA,CACA,aAAA,CACA,UAAA,CACA,QAAA,CACA,yBAAA,CACA,aAAA,CACA,SAAA,CAGF,aACE,aAAA,CACA,WAAA,CAGF,+BACE,aAAA,CAGF,oBACE,cAAA,CACA,+BAAA,CACA,aAAA,CAEA,uBAAA,CACA,qBAAA,CACA,uBAAA,CACA,qBAAA,CAEA,6CACE,iCAAA,CAIJ,aACE,gBAAA,CACA,wBAAA,CACA,WAAA,CACA,aAAA,CAGF,cACE,wBAAA,CACA,aAAA,CAGF,eACE,eAAA,CACA,kBAAA,CACA,SAAA,CACA,wBAAA,CACA,qBAAA,CAEA,oCACE,qBAAA,CACA,iBAAA,CACA,WAAA,CAIJ,uBACE,WAAA,CACA,gBAAA,CAGF,8BACE,WAAA,CACA,wBAAA,CACA,WAAA,CACA,wBAAA,CACA,aAAA,CACA,iBAAA,CACA,eAAA,CACA,WAAA,CAGF,kCACE,aAAA,CAGF,mCACE,WAAA,CACA,UAAA,CACA,YAAA,CAGF,4EACE,oBAAA,CACA,qBAAA,CAGF,wBACE,eAAA,CAGF,6BACE,cAAA,CAIJ,sCACE,gBAAA",sourcesContent:["#_canopy {\n  padding-top: 15px;\n  padding-bottom: 55px;\n\n  h1 {\n    text-align: center;\n    margin: auto;\n    width: 40%;\n    margin-top: 10px;\n  }\n\n  hr {\n    width: 120px;\n    display: block;\n    height: 1px;\n    border: 0;\n    border-top: 5px solid #ccc;\n    margin: 0px auto;\n    padding-bottom: 30px;\n  }\n\n  section.canopy-topic-section {\n    padding-top: 40px;\n  }\n\n  section.canopy-selected-section {\n    /* Removing DOM elements from the bottom of the screen can force the page to scroll upward to the existing elements\n    which is not animated. If we keep a padding on the bottom of the last element just beyond the viewport, then\n    removal of elements from the bottom of the visible stack never brings the real bottom of the page into view, and so\n    the scroll upwards can be animated using the window.scrollTo method. */\n\n    padding-bottom: calc(80vh);\n  }\n\n  section {\n    padding-top: 30px;\n  }\n\n  p {\n    overflow: hidden;\n    font-size: 22px;\n    max-width: 700px;\n    margin: auto;\n\n    line-height: 1.3;\n    letter-spacing: -.003em;\n    font-weight: 400;\n  }\n\n///////////// Link styles /////////////////\n\n  a.canopy-selectable-link {\n    text-decoration: underline #DDDDDD;\n    color: black;\n    cursor: pointer;\n\n    &:hover {\n      text-decoration: underline;\n    }\n\n    &:focus {\n      outline:0;\n    }\n\n    &.canopy-open-link {\n      text-shadow: .8px 0px 0px #000000;\n      text-decoration: underline;\n    }\n\n    &.canopy-selected-link {\n      background-color: #edeefc;\n      text-shadow: 0px 0px 0px #000000;\n      text-decoration: none;\n\n      &:hover {\n        text-decoration: underline;\n      }\n    }\n\n    /*\n    &.canopy-dfs-previously-selected-link {\n      color: #ff0000 !important;\n    }\n\n    &.canopy-reverse-dfs-previously-selected-link {\n      color: #0000ff !important;\n    }\n    */\n\n    &.canopy-url-link {\n      display: inline;\n\n      svg {\n        margin-left: 2px;\n      }\n     }\n  }\n\n/////////////////////////////////////////////\n\n  span.canopy-text-span {\n    display: block;\n  }\n\n  hr.canopy-footnote-rule {\n    width: 700px;\n    display: block;\n    height: 1px;\n    border: 0;\n    border-top: 1px solid #ccc;\n    margin: 12px 0;\n    padding: 0;\n  }\n\n  sup {\n    font-size: 60%;\n    padding: 2px;\n  }\n\n  .canopy-footnote-span {\n    font-size: 80%;\n  }\n\n  blockquote {\n    padding: 0 .7em;\n    border-left: 0.25em solid lightgray;\n    color: #565e67;\n\n    margin-block-start: .5em;\n    margin-block-end: .5em;\n    margin-inline-start: 0px;\n    margin-inline-end: 0px;\n\n    a.canopy-selectable-link {\n      text-decoration: underline #D3D3D3;\n    }\n  }\n\n  pre {\n    margin: 10px 10px;\n    background-color: #eff0f1;\n    padding: 5px;\n    font-size: 85%;\n  }\n\n  code {\n    background-color: #eff0f1;\n    font-size: 90%;\n  }\n\n  table {\n    margin: 7px auto;\n    table-layout: fixed;\n    width: 70%;\n    border-collapse: collapse;\n    border: 2px solid black;\n\n    td, th {\n      border: 2px solid black;\n      text-align: center;\n      padding: 6px;\n    }\n  }\n\n  .canopy-image {\n    width: 220px;\n    max-height: 250px;\n  }\n\n  div.canopy-image-div {\n    float: right;\n    border: 1px solid #c8ccd1;\n    padding: 3px;\n    background-color: #f8f9fa;\n    font-size: 94%;\n    text-align: center;\n    overflow: hidden;\n    margin: 10px;\n  }\n\n  div.canopy-image-div > sup {\n    display: block;\n  }\n\n  .canopy-url-link-span > svg {\n    height: 15px;\n    width: 12px;\n    display: none;\n  }\n\n  .canopy-selected-link + svg, .canopy-url-link-span:hover > svg {\n    display: inline-block;\n    vertical-align: middle;\n  }\n\n  ol, ul {\n    margin: 7px 10px;\n  }\n\n  div.canopy-raw-html {\n    display: inline;\n  }\n}\n\n#_canopy > section.canopy-topic-section {\n  padding-top: 30px;\n}\n"],sourceRoot:""}]);const c=o},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,a,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var c=0;c<this.length;c++){var s=this[c][0];null!=s&&(o[s]=!0)}for(var l=0;l<e.length;l++){var p=[].concat(e[l]);r&&o[p[0]]||(void 0!==i&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=i),n&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=n):p[2]=n),a&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=a):p[4]="".concat(a)),t.push(p))}},t}},537:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),i="/*# ".concat(a," */"),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(o).concat([i]).join("\n")}return[t].join("\n")}},269:function(e,t,n){var r;r=void 0!==n.g?n.g:this,e.exports=function(e){if(e.CSS&&e.CSS.escape)return e.CSS.escape;var t=function(e){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,n=String(e),r=n.length,a=-1,i="",o=n.charCodeAt(0);++a<r;)0!=(t=n.charCodeAt(a))?i+=t>=1&&t<=31||127==t||0==a&&t>=48&&t<=57||1==a&&t>=48&&t<=57&&45==o?"\\"+t.toString(16)+" ":0==a&&1==r&&45==t||!(t>=128||45==t||95==t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)?"\\"+n.charAt(a):n.charAt(a):i+="ï¿½";return i};return e.CSS||(e.CSS={}),e.CSS.escape=t,t}(r)},379:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},o=[],c=0;c<e.length;c++){var s=e[c],l=r.base?s[0]+r.base:s[0],p=i[l]||0,u="".concat(l," ").concat(p);i[l]=p+1;var h=n(u),d={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==h)t[h].references++,t[h].updater(d);else{var f=a(d,r);r.byIndex=c,t.splice(c,0,{identifier:u,updater:f,references:1})}o.push(u)}return o}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=r(e=e||[],a=a||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var c=n(i[o]);t[c].references--}for(var s=r(e,a),l=0;l<i.length;l++){var p=n(i[l]);0===t[p].references&&(t[p].updater(),t.splice(p,1))}i=s}}},569:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,a&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{"use strict";var e=n(379),t=n.n(e),r=n(795),a=n.n(r),i=n(569),o=n.n(i),c=n(565),s=n.n(c),l=n(216),p=n.n(l),u=n(589),h=n.n(u),d=n(570),f={};f.styleTagTransform=h(),f.setAttributes=s(),f.insert=o().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=p(),t()(d.Z,f),d.Z&&d.Z.locals&&d.Z.locals;var g=document.getElementById("_canopy"),m=g&&g.dataset.defaultTopic,y=g&&g.dataset.projectPathPrefix,A=g&&g.dataset.hashUrls;function v(e,t){for(var n=e.parentElement;n.classList&&!n.classList.contains(t);){if(n===g)return null;n=n.parentNode}return n}const k={};var b=n(240),C=n.n(b);function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const x=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"A"===t.tagName)this.element=t;else{if(t instanceof e)throw new Error("Cannot instantiate link from link");if("object"===S(t))this.metadataObject=t;else{if("function"!=typeof t)throw new Error("Invalid argument to Link constructor");this.selectorCallback=t}}}var t,n,r;return t=e,r=[{key:"collectMetadata",value:function(t){var n=new e(t);return{pathString:P.containingLink(n).path.string,text:t.dataset.text,relativeLinkNumber:n.relativeLinkNumber}}},{key:"containsLinkSelectionMetadata",value:function(e){return void 0!==e.relativeLinkNumber}},{key:"elementFromMetadata",value:function(e){var t=new _(e.pathString).paragraph;if(!t)throw new Error("Link selection data refers to non-existant link");var n=t.linkBySelector((function(t,n){return t.element.dataset.text===e.text&&n===e.relativeLinkNumber}));return n&&n.element||null}},{key:"select",value:function(t){t&&t.element.classList.add("canopy-selected-link"),e.persistInHistory(t),e.persistInSession(t),e.persistLastSelectionData(t)}},{key:"selectionPresentInEvent",value:function(t){return t.state&&e.containsLinkSelectionMetadata(t.state)}},{key:"sessionSelection",get:function(){var t=sessionStorage.getItem(_.current.string);if(t&&"null"!==t){var n=new e(JSON.parse(t));try{n.element}catch(e){n=null}return n}return null}},{key:"historySelection",get:function(){if(history.state&&e.containsLinkSelectionMetadata(history.state)){var t=new e(history.state);try{t.element}catch(e){t=null}return t}return null}},{key:"priorSelection",get:function(){return this.historySelection||this.sessionSelection||null}},{key:"selection",get:function(){var t=document.querySelector("a.canopy-selected-link");return t?new e(t):null}},{key:"persistInSession",value:function(e){var t=e&&JSON.stringify(e.metadata);sessionStorage.setItem(location.pathname+location.hash,t||null)}},{key:"persistInHistory",value:function(e){history.replaceState(e&&e.metadata||null,document.title,window.location.href)}},{key:"selectALink",value:function(t){return new e((function(){var e=(t=t||_.current).paragraph;return e.firstLink||e.parentLink}))}},{key:"current",value:function(){throw new Error("Link#current does not exist, try Link#selection")}},{key:"persistLastSelectionData",value:function(e){if(e){var t=JSON.parse(sessionStorage.getItem("lastSelectionsOfParagraph")||"{}");t[e.enclosingParagraph.path]=e.metadata,sessionStorage.setItem("lastSelectionsOfParagraph",JSON.stringify(t))}}},{key:"lastSelectionOfParagraph",value:function(t){var n=JSON.parse(sessionStorage.getItem("lastSelectionsOfParagraph")||"{}");if(n[t.path]){var r=new e(n[t.path]);try{if(r.element)return r}catch(e){return null}}}}],(n=[{key:"equals",value:function(e){return this.element===e.element}},{key:"matches",value:function(e){if(!e)throw new Error("Invalid link argument to Link#matches");return this.targetTopic===e.targetTopic&&this.targetSubtopic===e.targetSubtopic&&this.relativeLinkNumber===e.relativeLinkNumber}},{key:"contradicts",value:function(e){if(!(e instanceof _))throw new Error("Invalid path argument to Link#contradicts");return this.paragraphPathWhenSelected.string!==e.string}},{key:"element",get:function(){if(this.linkElement)return this.linkElement;if(this.metadataObject){if(this.element=e.elementFromMetadata(this.metadata),!this.linkElement)throw new Error("Metadata refered to non-existant link");return this.linkElement}if(this.selectorCallback){var t=this.selectorCallback();if(!t)throw new Error("Link selector callback provided no link");return this.element=t.element,this.linkElement}},set:function(t){t instanceof HTMLAnchorElement?this.linkElement=t:t instanceof e&&(this.linkElement=t.element),this.transferDataset()}},{key:"transferDataset",value:function(){this.linkElement&&(this._targetTopic=this.linkElement.dataset.targetTopic,this._targetSubtopic=this.linkElement.dataset.targetSubtopic,this._enclosingTopic=this.linkElement.dataset.enclosingTopic,this._enclosingSubtopic=this.linkElement.dataset.enclosingSubtopic,this._typeValue=this.linkElement.dataset.type)}},{key:"targetTopic",get:function(){return C().fromMixedCase(this.element.dataset.targetTopic)}},{key:"targetSubtopic",get:function(){return C().fromMixedCase(this.element.dataset.targetSubtopic)}},{key:"enclosingTopic",get:function(){return C().fromMixedCase(this.element.dataset.enclosingTopic)}},{key:"enclosingSubtopic",get:function(){return C().fromMixedCase(this.element.dataset.enclosingSubtopic)}},{key:"topicName",get:function(){throw new Error("Links have no topicName, only targetTopic or enclosingTopic")}},{key:"subtopicName",get:function(){throw new Error("Links have no subtopicName, only targetSubtopic or enclosingSubtopic")}},{key:"type",get:function(){return this.element.dataset.type}},{key:"enclosingSectionElement",get:function(){return v(this.element,"canopy-section")}},{key:"sectionElement",get:function(){throw new Error("Depreciated in favor of #enclosingSectionElement")}},{key:"enclosingParagraphElement",get:function(){return v(this.element,"canopy-paragraph")}},{key:"parentParagraphElement",get:function(){throw new Error("Depreciated in favor of #enclosingParagraphElement")}},{key:"enclosingParagraph",get:function(){return new P(this.enclosingSectionElement)}},{key:"targetParagraph",get:function(){if(!this.isParent)return null;var e=this.enclosingParagraph.pathDepth;this.isGlobalOrImport&&(e=Number(e)+1);var t=this.enclosingParagraph.sectionElement.querySelector('section[data-topic-name="'.concat(this.targetTopic.mixedCase,'"]')+'[data-subtopic-name="'.concat(this.targetSubtopic.mixedCase,'"]')+'[data-path-depth="'.concat(e,'"'));if(!t)throw new Error("Did not find paragraph child element matching link [".concat(this.targetTopic.mixedCase,", ").concat(this.targetSubtopic.mixedCase,"]"));return new P(t)}},{key:"atNewPath",value:function(t){var n=this;return new e((function(){return(n.isParent?t.paragraph.parentParagraph:t.paragraph).links.find(n.matcher)}))}},{key:"localPathSegmentWhenSelected",get:function(){return this.isGlobalOrImport?new _(this.paragraphPathWhenSelected.pathArray.slice(-2)):this.paragraphPathWhenSelected.lastSegment}},{key:"matcher",get:function(){var e=this;return function(t){return t.matches(e)}}},{key:"relativeLinkNumber",get:function(){return this.storedRelativeLinkNumber||(this.storedRelativeLinkNumber=this.enclosingParagraph.links.map((function(e){return e.element})).indexOf(this.element)),this.storedRelativeLinkNumber}},{key:"metadata",get:function(){if(this.metadataObject)return this.metadataObject;if(this.linkElement){var t=e.collectMetadata(this.linkElement);return this.metadataObject=t,t}if(this.selectorCallback)return this.element=this.selectorCallback(),this.metadata;throw new Error("Link has neither supplied metadata, dom element, nor selector function")}},{key:"targetPath",get:function(){return this.isGlobalOrImport?this.enclosingParagraph.path.addSegment(this.targetTopic,this.targetSubtopic):this.isLocal?this.enclosingParagraph.path.replaceTerminalSubtopic(this.targetSubtopic):null}},{key:"path",get:function(){throw new Error("Depreciated in favor of #paragraphPathWhenSelected")}},{key:"pathToDisplay",get:function(){throw new Error("Depreciated in favor of #paragraphPathWhenSelected")}},{key:"paragraphPathWhenSelected",get:function(){return this.isGlobalOrImport?this.enclosingParagraph.path.addSegment(this.targetTopic,this.targetSubtopic):this.isLocal?this.enclosingParagraph.path.replaceTerminalSubtopic(this.targetSubtopic):this.enclosingParagraph.path}},{key:"urlPathWhenSelected",get:function(){return this.paragraphPathWhenSelected}},{key:"nextSibling",get:function(){var e=this.enclosingParagraph.links;if(this.equals(e[e.length-1]))return null;var t=e.map((function(e){return e.element}));return e[t.indexOf(this.element)+1]}},{key:"previousSibling",get:function(){var e=this.enclosingParagraph.links;if(this.equals(e[0]))return null;var t=e.map((function(e){return e.element}));return e[t.indexOf(this.element)-1]}},{key:"siblings",get:function(){return this.enclosingParagraph.links}},{key:"firstSibling",get:function(){return this.siblings[0]}},{key:"lastSibling",get:function(){return this.siblings[this.siblings.length-1]}},{key:"firstChildLink",get:function(){return this.targetParagraph.firstLink}},{key:"lastChildLink",get:function(){return this.targetParagraph.lastLink}},{key:"parentLink",get:function(){return this.enclosingParagraph.parentLink}},{key:"grandParentLink",get:function(){var e;return null===(e=this.parentLink)||void 0===e?void 0:e.parentLink}},{key:"topicParagraph",get:function(){return v(this.element,"canopy-topic-section")}},{key:"selected",get:function(){return this.element.classList.includes("canopy-selected-link")}},{key:"open",value:function(){this.element.classList.add("canopy-open-link")}},{key:"isOpen",get:function(){return this.element.classList.contains("canopy-open-link")}},{key:"isClosed",get:function(){return!this.isOpen}},{key:"isSelected",get:function(){return this.element.classList.contains("canopy-selected-link")}},{key:"isGlobal",get:function(){return"global"===this.type}},{key:"isImport",get:function(){return"import"===this.type}},{key:"isGlobalOrImport",get:function(){return"global"===this.type||"import"===this.type}},{key:"isLocal",get:function(){return"local"===this.type}},{key:"isParent",get:function(){return this.isGlobal||this.isLocal||this.isImport}},{key:"hasChildren",get:function(){return this.targetParagraph.hasLinks}}])&&w(t.prototype,n),r&&w(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const P=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t||"SECTION"!==t.tagName)throw new Error("Paragraph instantiation requires section element");if(!t.classList.contains("canopy-section"))throw new Error("Paragraph class requires Canopy section element");this.sectionElement=t,this.transferDataset()}var t,n,r;return t=e,r=[{key:"current",get:function(){return new e(document.querySelector(".canopy-selected-section"))}},{key:"pageRoot",get:function(){return _.current.rootTopicPath.paragraph}},{key:"containingLink",value:function(t){if(!(t instanceof x))throw new Error("Must provide link instance argument");return new e(v(t.element,"canopy-section"))}}],(n=[{key:"equals",value:function(e){return!!e&&this.sectionElement===e.sectionElement}},{key:"display",value:function(){this.sectionElement.style.display="block"}},{key:"element",get:function(){throw new Error("Depreciated in favor of #sectionElement property")}},{key:"transferDataset",value:function(){this._topicName=this.sectionElement.dataset.topicName,this._subtopicName=this.sectionElement.dataset.subtopicName,this.pathDepth=this.sectionElement.dataset.pathDepth}},{key:"topic",get:function(){return C().fromMixedCase(this.sectionElement.dataset.topicName)}},{key:"subtopic",get:function(){return C().fromMixedCase(this.sectionElement.dataset.subtopicName)}},{key:"topicName",get:function(){throw new Error("Depreciated in favor of #topic")}},{key:"subtopicName",get:function(){throw new Error("Depreciated in favor of #subtopic")}},{key:"paragraphElement",get:function(){var e=Array.from(this.sectionElement.childNodes).find((function(e){return"P"===e.tagName}));if(!e)throw new Error("Paragraph has no paragraph element");return e}},{key:"path",get:function(){for(var t=[],n=this.sectionElement,r=this,a=this.topicParagraph;n!==g;)for(a=r.topicParagraph,t.unshift([C().fromMixedCase(n.dataset.topicName),C().fromMixedCase(n.dataset.subtopicName)]);n!==g&&r.topicParagraph.equals(a);)(n=n.parentNode)!==g&&(r=new e(n));return new _(t)}},{key:"links",get:function(){if(this.linkObjects)return this.linkObjects;var e=this.paragraphElement.querySelectorAll("a.canopy-selectable-link");return this.linkObjects=Array.from(e).map((function(e){return new x(e)})),this.linkObjects}},{key:"firstLink",get:function(){return this.links[0]||null}},{key:"lastLink",get:function(){return this.links[this.links.length-1]||null}},{key:"isPageRoot",get:function(){return this.sectionElement.parentNode===g}},{key:"isTopic",get:function(){return this.topic.caps===this.subtopic.caps}},{key:"hasLinks",get:function(){return this.links.length>0}},{key:"linkBySelector",value:function(e){return this.links.find(e)}},{key:"linksBySelector",value:function(e){return this.links.filter(e)}},{key:"linkByTarget",value:function(e,t){return t=t||e,this.linkBySelector((function(n){return n.targetTopic.caps===e.caps&&n.targetSubtopic.caps===t.caps}))}},{key:"parentLink",get:function(){return this.sectionElement.parentNode===g?null:this.parentParagraph&&this.parentParagraph.linkByTarget(this.topic,this.subtopic)}},{key:"parentLinks",get:function(){var e=this;return this.sectionElement.parentNode===g?null:this.parentParagraph.linksBySelector((function(t){return(t.isLocal||t.isGlobal)&&e.topic.caps===t.targetTopic.caps&&e.subtopic.caps===t.targetSubtopic.caps}))}},{key:"ancestorImportReferences",get:function(){var e=this;return this.pageRoot?[]:this.topicParagraph.parentParagraph?this.topicParagraph.parentParagraph.linksBySelector((function(t){return t.isImport&&e.topic.caps===t.targetTopic.caps&&e.subtopic.caps===t.targetSubtopic.caps})):[]}},{key:"displayTopicName",get:function(){return this.sectionElement.dataset.displayTopicName}},{key:"parentParagraph",get:function(){if(this.sectionElement){var t=v(this.sectionElement,"canopy-section");return t?new e(t):null}return null}},{key:"topicParagraph",get:function(){return this.isTopic?this:new e(v(this.sectionElement,"canopy-topic-section"))}},{key:"isTopicRoot",get:function(){return this.topicName===this.subtopicName}},{key:"select",value:function(){this.sectionElement.classList.add("canopy-selected-section")}}])&&E(t.prototype,n),r&&E(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,c=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){c=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(c)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t?Array.isArray(t)?(0===t.length?this.pathArray=[]:(this.pathArray=t.slice(),e.validatePathArray(this.pathArray)),this.pathString=e.arrayToString(this.pathArray)):("string"==typeof t||t instanceof String)&&(this.pathArray=e.stringToArray(t),this.pathString=e.arrayToString(this.pathArray)):this.pathArray=[]}var t,n,r;return t=e,r=[{key:"validatePathArray",value:function(e){e.forEach((function(e){if(2!==e.length)throw newError("Invalid path segment format: ".concat(e));if(!(e[0]instanceof C()&&e[1]instanceof C()))throw newError("Invalid path segment format: ".concat(e))}))}},{key:"default",get:function(){var t=C().fromMixedCase(m);return new e([[t,t]])}},{key:"current",get:function(){var t=window.location.href.slice(window.location.origin.length);return y&&0===t.indexOf("/".concat(y))&&(t=t.slice(y.length+1)),0===t.indexOf("/#")&&(t=t.slice(2)),new e(t)}},{key:"currentOrDefault",get:function(){return e.current.empty?e.default:e.current}},{key:"forTopic",value:function(t){return new e([[t,t]])}},{key:"forSegment",value:function(t,n){return new e([[t,n]])}},{key:"stringToArray",value:function(t){if("string"!=typeof t)throw newError("Function requires string argument");if("/"===t)return[];var n=t.split("/").filter((function(e){return""!==e})),r=(n=e.fixOrphanSubtopics(t,n)).map((function(e){var t=e.match(/([^#]*)(?:#([^#]*))?/);return[t[1]||t[2]||null,t[2]||t[1]||null]})).filter((function(e){return null!==e[0]}));return r.map((function(e){var t=L(e,2),n=t[0],r=t[1];return[C().fromEncodedSlug(n),C().fromEncodedSlug(r)]}))}},{key:"arrayToString",value:function(e){if(!Array.isArray(e))throw newError("Argument must be array");if(Array.isArray(e)&&0===e.length)return"/";if(!Array.isArray(e[0]))throw newError("Path array must be two-dimensional array");return"/"+e.map((function(e){var t=L(e,2),n=t[0],r=t[1],a=n.slug;return r&&r.slug!==n.slug&&(a+="#"+r.slug),a})).join("/")}},{key:"fixOrphanSubtopics",value:function(e,t){if("string"!=typeof e)throw newError("pathString must be a string argument");if(!Array.isArray(t))throw newError("slashSeparatedUnits must be an array");if(e.match(/\/#\w+/))for(var n=1;n<t.length;n++)if(t[n].match(/^#/)){if(t[n-1].match(/#/)){var r=t[n].slice(1);return t.slice(0,n).concat([r]).concat(t.slice(n+1))}var a=t[n-1]+t[n];return t.slice(0,n-1).concat([a]).concat(t.slice(n+1))}return t}},{key:"connectingLinkValid",value:function(t,n){if(!t)throw newError("Parent element required");if(!(n instanceof e))throw newError("pathToDisplay must be a Path object");if(t===g)return!0;var r=new P(t);return!!r.linkByTarget(n.firstTopic)||(console.error("Parent element [".concat(r.topic.mixedCase,", ").concat(r.subtopic.mixedCase,"] has no ")+"connecting link to subsequent path segment [".concat(n.firstTopic,", ").concat(n.firstTopic,"]")),!1)}},{key:"elementAtRelativePath",value:function(t,n){if(!(t instanceof e))throw newError("pathToDisplay must be a Path object");!n||n.tagName;var r=n;n||(r=g);var a=t,i=r;if(r===g){if(i=r.querySelector('[data-topic-name="'.concat(a.firstTopic.escapedMixedCase,'"]')+'[data-subtopic-name="'.concat(a.firstSubtopic.escapedMixedCase,'"]')+'[data-path-depth="'.concat(0,'"]')),1===a.length)return i;if(!i)return null;a=a.withoutFirstSegment}for(var o=a,c=0;c<a.length;c++){var s=Number(i.dataset.pathDepth)+1;if(!(i=i.querySelector('[data-topic-name="'.concat(o.firstTopic.escapedMixedCase,'"]')+'[data-subtopic-name="'.concat(o.firstSubtopic.escapedMixedCase,'"]')+'[data-path-depth="'.concat(s,'"]'))))return null;o=o.withoutFirstSegment}return i}},{key:"setPath",value:function(t){if(!(t instanceof e))throw newError("newPath must be Path object");var n=e.current,r=t.firstTopic.display,a=e.current.empty||t.equals(n)?function(e,t,n){history.replaceState(e,t,n)}:function(e,t,n){history.pushState(e,t,n)},i=(y?"/".concat(y):"")+(A?"/#":"")+t.string;a(history.state,r,i)}}],(n=[{key:"equals",value:function(e){return this.string===e.string}},{key:"addSegment",value:function(t,n){return this.empty?new e([[t,n]]):new e(this.pathArray.concat([[t,n]]))}},{key:"replaceTerminalSubtopic",value:function(e){var t=this.lastSegment;return this.withoutLastSegment.addSegment(t.firstTopic,e)}},{key:"toString",value:function(){return this.string}},{key:"array",get:function(){return this.pathArray}},{key:"string",get:function(){return this.pathString}},{key:"rootTopicPath",get:function(){return this.length>0?new e([[this.firstTopic,this.firstTopic]]):this}},{key:"firstTopic",get:function(){return this.pathArray[0][0]}},{key:"lastTopic",get:function(){return this.lastSegment.topic}},{key:"topic",get:function(){var e;return null===(e=this.lastSegment.pathArray[0])||void 0===e?void 0:e[0]}},{key:"firstSubtopic",get:function(){return this.pathArray[0][1]}},{key:"secondTopic",get:function(){return this.pathArray[1]&&this.pathArray[1][0]}},{key:"secondSubtopic",get:function(){return this.pathArray[1]&&this.pathArray[1][1]}},{key:"firstSegment",get:function(){return new e(this.pathArray.slice(0,1))}},{key:"lastSegment",get:function(){return new e(this.pathArray.slice(-1))}},{key:"withoutFirstSegment",get:function(){return new e(this.pathArray.slice(1))}},{key:"withoutLastSegment",get:function(){return new e(this.pathArray.slice(0,-1))}},{key:"length",get:function(){return this.pathArray[0]?this.pathArray.length:0}},{key:"sectionElement",get:function(){return e.elementAtRelativePath(this,g)}},{key:"paragraph",get:function(){return this.sectionElement?new P(this.sectionElement):null}},{key:"empty",get:function(){return!this.pathArray[0]}}])&&N(t.prototype,n),r&&N(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),O=function(e){if(k[e.mixedCase])return k[e.mixedCase];var t=y+"/_data/"+e.requestFileName+".json",n=fetch(t).then((function(e){return e.json().then((function(e){return e}))})).catch((function(){return k[e.mixedCase]=void 0,Promise.reject(new Error('Unable to find topic file: "'.concat(e.requestFileName,'"')))}));return k[e.mixedCase]=n,n};function B(e){return function(t){var n,r;t.preventDefault();var a=t.metaKey||t.ctrlKey;return a||t.altKey||!e.isSelected?a||t.altKey||e.isSelected?!a&&t.altKey?(n=_.forSegment(e.targetTopic,e.targetSubtopic),U(n,r,{scrollStyle:"auto"})):a&&!t.altKey?(n=e.paragraphPathWhenSelected,window.open(location.origin+n.string,"_blank")):a&&t.altKey?(n=_.forSegment(e.targetTopic,e.targetSubtopic),window.open(location.origin+n.string,"_blank")):void 0:(n=e.paragraphPathWhenSelected,U(n,r=e)):(n=e.enclosingParagraph.path,U(n,r))}}const D=function(e){var t,n="",r=!1,a=[],i={_:"I","*":"B","~":"S","`":"CODE"},o=[];e=function e(t){var n=t.replace(/(^|[\s}_*`~"'{[(\]})]+)([*`_~])(.*?(?!{{CLOSE|{{OPEN|\\))(\2)(?=[\s.,{*_`~"'{[(\]})]|$)/g,"$1{{OPEN$2}}$3{{CLOSE$4}}");return t===n?n:e(n)}(e=(e=e.replace(/{{(OPEN|CLOSE).}}/g,(function(e){return e.split("").join("\\")}))).replace(/(^|[\s_*`~"'([{}\]\)]+)([`])(.*?[^\\])(\2)(?=[\s.,{*_`~"'{[(\]})]|$)/g,(function(e,t,n,r,a){return t+n+r.replace(/([^\\]|^)\\(?=[^\\]|$)/g,"$1").replace(/\\\\/g,"\\").split("").join("\\")+a})));for(var c=0;c<e.length;c++){var s=e.slice(c).match(/^{{OPEN(.)}}/),l=e.slice(c).match(/^{{CLOSE(.)}}/);if(s){var p=s[1];if(n){var u=document.createTextNode(n);n="",t?t.appendChild(u):o.push(u)}var h=document.createElement(i[p]);t?t.appendChild(h):o.push(h),t=h,a.push(p),c+=s[0].length-1}else if(l&&a.slice(-1)[0]===l[1]){if(n){var d=document.createTextNode(n);n="",t?t.appendChild(d):o.push(d)}t=t.parentNode||null,a.pop(),c+=l[0].length-1}else l&&a.slice(-1)[0]!==l[1]?(n+=l[1],c+=l[0].length-1):r||"\\"!==e[c]?(n+=e[c],r=!1):r=!0}if(n){var f=document.createTextNode(n);o.push(f)}return o};function I(e,t){return"text"===e.type?function(e){var t=document.createElement("SPAN");return j(D(e.text),t),t}(e):"local"===e.type?function(e,t){return(0,t.localLinkSubtreeCallback)(e),function(e){var t,n=document.createElement("a");n.classList.add("canopy-selectable-link"),n.dataset.targetTopic=e.targetTopic,n.dataset.targetSubtopic=e.targetSubtopic,n.dataset.enclosingTopic=e.enclosingTopic,n.dataset.enclosingSubtopic=e.enclosingSubtopic,n.dataset.text=e.text,j(D(e.text),n),n.addEventListener("click",(e.targetTopic,e.targetSubtopic,t=new x(n),function(e){var n,r;e.preventDefault();var a,i=e.metaKey||e.ctrlKey;if(i&&!e.altKey)return window.open(location.origin+t.targetPath.string,"_blank");if(i&&e.altKey)return window.open(location.origin+t.targetPath.lastSegment.string,"_blank");if(!i&&e.altKey){var o=t.targetPath.lastSegment;return U(o,t.atNewPath(o))}return i||e.altKey||!t.isSelected?i||e.altKey||t.isSelected?void 0:(n=t.paragraphPathWhenSelected,U(n,r=t)):(n=(null===(a=t.parentLink)||void 0===a?void 0:a.paragraphPathWhenSelected)||_.current.rootTopicPath,U(n,r))})),n.classList.add("canopy-local-link"),n.dataset.type="local";var r=new(C())(e.targetTopic),a=new(C())(e.targetSubtopic);return n.href="/".concat(r.slug,"#").concat(a.slug),n}(e)}(e,t):"global"===e.type?function(e,t){t.pathArray;var n=t.globalLinkSubtreeCallback,r=function(e){var t=document.createElement("a");j(D(e.text),t),t.classList.add("canopy-global-link"),t.classList.add("canopy-selectable-link"),t.dataset.type="global",t.dataset.targetTopic=e.targetTopic,t.dataset.targetSubtopic=e.targetSubtopic,t.dataset.enclosingTopic=e.enclosingTopic,t.dataset.enclosingSubtopic=e.enclosingSubtopic,t.dataset.text=e.text;var n=C().fromMixedCase(e.targetTopic);return t.href="/".concat(n.slug),t.addEventListener("click",B(new x(t))),t}(e);return n(e,r),r}(e,t):"import"===e.type?function(e,t){return t.pathArray,function(e){var t=document.createElement("a");j(D(e.text),t),t.classList.add("canopy-global-link"),t.classList.add("canopy-selectable-link"),t.dataset.type="import",t.dataset.targetTopic=e.targetTopic,t.dataset.targetSubtopic=e.targetSubtopic,t.dataset.enclosingTopic=e.enclosingTopic,t.dataset.enclosingSubtopic=e.enclosingSubtopic,t.dataset.text=e.text;var n=new(C())(e.targetTopic),r=new(C())(e.targetSubtopic);return t.href="/".concat(n.slug,"#").concat(r.slug),t.addEventListener("click",B(new x(t))),t}(e)}(e,t):"url"===e.type?function(e){var t=document.createElement("a"),n=document.createElement("SPAN");n.classList.add("canopy-url-link-span"),t.classList.add("canopy-url-link"),t.classList.add("canopy-selectable-link"),t.dataset.type="url",t.dataset.text=e.text,t.setAttribute("href",e.url),t.setAttribute("target","_blank"),j(D(e.text),n);var r=document.createElement("div");return r.classList.add("canopy-url-link-container"),r.appendChild(n),t.appendChild(n),t}(e):"image"===e.type?function(e){var t=document.createElement("DIV");t.classList.add("canopy-image-div");var n=document.createElement("IMG");t.appendChild(n),n.setAttribute("src",e.resourceUrl),n.classList.add("canopy-image");var r=document.createElement("A");if(r.setAttribute("href",e.anchorUrl||e.resourceUrl),r.setAttribute("target","_blank"),r.appendChild(n),t.appendChild(r),e.title){n.setAttribute("title",e.title);var a=document.createElement("SUP"),i=document.createElement("DIV");a.appendChild(document.createTextNode(e.title)),a.classList.add("canopy-image-caption"),i.classList.add("canopy-caption-div"),t.appendChild(a)}else t.appendChild(r);return e.altText&&n.setAttribute("alt",e.altText),t}(e):"html_element"===e.type?function(e){var t=document.createElement("DIV");return t.innerHTML=e.html,t.classList.add("canopy-raw-html"),t}(e):"footnote"===e.type?function(e){var t=document.createElement("SUP"),n=document.createTextNode(e.text);return t.appendChild(n),t}(e):"code_block"===e.type?function(e){var t=document.createElement("PRE"),n=document.createElement("CODE");return t.appendChild(n),n.innerText=e.text,t}(e):"quote"===e.type?function(e){var t=document.createElement("BLOCKQUOTE");return t.innerText=e.text,t}(e):"list"===e.type?M(e.topLevelNodes,t):"table"===e.type?function(e,t){var n=document.createElement("TABLE");return e.rows.forEach((function(e){var r=document.createElement("TR");e.forEach((function(e){var n=document.createElement("TD");e.forEach((function(e){var r=I(e,t);n.appendChild(r)})),r.appendChild(n)})),n.appendChild(r)})),n}(e,t):"html_block"===e.type?function(e){var t=document.createElement("DIV");return t.innerHTML=e.html,t.classList.add("canopy-raw-html"),t}(e):"footnote_rule"===e.type?((n=document.createElement("HR")).classList.add("canopy-footnote-rule"),n):"footnote_line"===e.type?function(e,t){var n=document.createElement("SPAN");n.classList.add("canopy-footnote-span");var r=document.createTextNode(e.superscript+". ");return n.appendChild(r),e.tokens.forEach((function(e){var r=I(e,t);n.appendChild(r)})),n}(e,t):void 0;var n}function j(e,t){e.forEach((function(e){t.appendChild(e)}))}function M(e,t){var n=e[0].ordered?document.createElement("OL"):document.createElement("UL");return e[0].ordered&&n.setAttribute("type",e[0].ordinal),e.forEach((function(e){var r=document.createElement("LI");if(e.tokensOfLine.forEach((function(e){var n=I(e,t);r.appendChild(n)})),e.children.length>0){var a=M(e.children);r.appendChild(a)}n.appendChild(r)})),n}const W=I;const q=function e(t){var n=t.subtopic,r=t.paragraphsBySubtopic,a=function(e){var t=e.topic,n=e.subtopic,r=e.displayTopicName,a=e.pathDepth,i=document.createElement("section");i.classList.add("canopy-section");var o=document.createElement("p");return o.classList.add("canopy-paragraph"),i.appendChild(o),i.style.display="none",i.dataset.displayTopicName=r,i.dataset.topicName=t.mixedCase,i.dataset.subtopicName=n.mixedCase,i.dataset.pathDepth=a,t.mixedCase===n.mixedCase&&(a>0&&i.prepend(document.createElement("hr")),i.classList.add("canopy-topic-section")),i}(t),i=new P(a);t.displayBlockingPromises=[],t.localLinkSubtreeCallback=function(t,n){return function(r){var a=e(Object.assign({},n,{subtopic:C().fromMixedCase(r.targetSubtopic)}));a.then((function(e){t.appendChild(e)})),n.displayBlockingPromises.push(a)}}(a,t),t.globalLinkSubtreeCallback=function(e,t){var n=t.pathToDisplay,r=t.subtopic,a=t.displayBlockingPromises;return function(t,i){var o=C().fromMixedCase(t.targetTopic),c=new x(i);if(O(o),function(e,t,n){var r=t.firstSubtopic,a=t.secondTopic,i=t.secondTopic,o=i,c=e.targetTopic.mixedCase===(null==i?void 0:i.mixedCase)&&e.targetSubtopic.mixedCase===(null==o?void 0:o.mixedCase),s=n.mixedCase===r.mixedCase;return a&&c&&s}(c,n,r)){var s=n.withoutFirstSegment,l=F(s,e);a.push(l)}}}(a,t);var o=r[n.mixedCase];if(!o)throw new Error("Paragraph with subtopic not found: ".concat(n.mixedCase));return o.forEach((function(e){var n=W(e,t);i.paragraphElement.appendChild(n)})),Promise.all(t.displayBlockingPromises).then((function(){return a}))},F=function e(t,n){if(0===t.length)return Promise.resolve(null);var r=_.elementAtRelativePath(t.firstSegment,n);return r?_.connectingLinkValid(n,t)?e(t.withoutFirstSegment,r):Promise.resolve():O(t.firstTopic).then((function(e){var r=e.paragraphsBySubtopic,a=e.displayTopicName;return q({topic:t.firstTopic,subtopic:t.firstTopic,pathToDisplay:t,displayTopicName:a,paragraphsBySubtopic:r,pathDepth:Number(n.dataset.pathDepth)+1||0})})).then((function(e){return n.appendChild(e)}))};var R=function e(t){t.display(),t.isPageRoot||(t.parentLink&&t.parentLinks.forEach((function(e){return e.open()})),t.ancestorImportReferences.forEach((function(e){return e.open()})),t.parentLink&&!x.selection&&x.select(t.parentLink),e(t.parentParagraph))};const G=function(e,t,n){if(n=n||{},!e.paragraph)return function(e,t){if(console.error("No section element found for path: ",e.string),e.length>1)return console.log("Trying: ",e.withoutLastSegment.string),G(e.withoutLastSegment);if(t.defaultRedirect)throw new Error("Redirect to default topic failed terminally.");return console.error("No path prefixes remain to try. Redirecting to default topic: "+_.default),U(_.default,null,{defaultRedirect:!0})}(e,n);try{null==t||t.element}catch(t){return U(e,null,n)}if(null!=t&&t.contradicts(e))return U(t.paragraphPathWhenSelected,t,n);Array.from(document.getElementsByTagName("a")).forEach((function(e){e.classList.remove("canopy-selected-link"),e.classList.remove("canopy-open-link")})),Array.from(document.getElementsByTagName("section")).forEach((function(e){e.style.display="none"})),Array.from(document.querySelectorAll(".canopy-selected-section")).forEach((function(e){e.classList.remove("canopy-selected-section")})),_.setPath((null==t?void 0:t.urlPathWhenSelected)||e),function(e){var t=document.querySelector("#_canopy h1");t&&t.remove();var n=document.createElement("h1"),r=D(e);Array.from(r).forEach((function(e){n.appendChild(e)})),g.prepend(n)}(e.rootTopicPath.paragraph.displayTopicName),document.title=e.rootTopicPath.paragraph.topic.mixedCase,x.select(t),e.paragraph.select(),R(e.paragraph),function(e){var t=e.scrollStyle||"smooth",n=x.selection?x.selection.element.offsetTop-.23*window.screen.height:0;window.scrollTo({top:n,behavior:t})}(n)},U=function(e,t,n){return function(e,t){if(!(e instanceof _))throw new Error("Invalid path argument");if(t&&!(t instanceof x))throw new Error("Invalid link selection argument")}(e,t),e.empty&&(e=_.default),F(e,g).catch((function(e){return console.error(e)})).then((function(){G(e,t,n)})).catch((function(e){return console.error(e)}))};function K(){var e=x.selection;return e.enclosingParagraph.equals(P.pageRoot)?U(e.enclosingParagraph.path):U(e.parentLink.paragraphPathWhenSelected,new x((function(){return x.lastSelectionOfParagraph(e.parentLink.enclosingParagraph)||e.parentLink})))}function $(){var e=x.selection,t=x.lastSelectionOfParagraph(e.enclosingParagraph.topicParagraph.parentParagraph)||e.enclosingParagraph.topicParagraph.parentLink;return U((null==t?void 0:t.paragraphPathWhenSelected)||_.current,t||e)}function z(){var e=x.selection;if(e.isImport&&U(e.paragraphPathWhenSelected,e.targetParagraph.parentLink),e.isGlobal||e.isLocal){var t,n,r=(null===(t=e.targetParagraph)||void 0===t?void 0:t.firstLink)||(null===(n=e.targetParagraph)||void 0===n?void 0:n.parentLink);U(r.paragraphPathWhenSelected,new x((function(){return x.lastSelectionOfParagraph(r.enclosingParagraph)||r})))}e.isParent||U(e.paragraphPathWhenSelected,e)}function J(){var e=x.selection.previousSibling||x.selection.lastSibling;return U(e.paragraphPathWhenSelected,e)}function H(){var e=x.selection.nextSibling||x.selection.firstSibling;return U(e.paragraphPathWhenSelected,e)}function V(e){var t=e.newTab,n=e.altKey;if(x.selection.isLocal&&!n){var r,a,i=(null===(r=x.selection.targetParagraph)||void 0===r?void 0:r.firstLink)||(null===(a=x.selection.targetParagraph)||void 0===a?void 0:a.parentLink),o=i.paragraphPathWhenSelected;return t?window.open(location.origin+x.selection.targetPath.lastSegment,"_blank"):U(o,i)}if(x.selection.isGlobal){if(t){var c=x.selection.targetPath.lastSegment;return window.open(location.origin+c.string,"_blank")}if(!t){var s=x.selection.targetPath.lastSegment;return U(s,null,{scrollStyle:"auto"})}}if(x.selection.isImport){var l=x.selection.targetPath.lastSegment;return t?window.open(location.origin+l.string,"_blank"):U(l,x.selection.parentLink.atNewPath(l),{scrollStyle:"auto"})}if("url"===x.selection.type)return window.open(x.selection.element.href,"_blank")}var Z={left:J,up:K,down:z,right:H,h:J,j:z,k:K,l:H,escape:function(){return U(_.current.rootTopicPath)},z:function(){var e=x.selection,t=e.localPathSegmentWhenSelected,n=e.atNewPath(t);return U(t,n,{scrollStyle:"auto"})},d:function(){return window.open(window.location.href,"_blank")},"shift-up":$,"shift-k":$,enter:function(){return V({})},"meta-enter":function(){return V({newTab:!0})},"ctrl-enter":function(){return V({newTab:!0})},"alt-enter":function(){return V({newTab:!1,altKey:!0})},"meta-alt-enter":function(){return V({newTab:!0,altKey:!0})},"ctrl-alt-enter":function(){return V({newTab:!0,altKey:!0})},tab:function(){var e=x.selection;if(e.isLocal&&e.hasChildren){var t=e.firstChildLink||e.nextSibling||e;return U(t.paragraphPathWhenSelected,t)}if(e.isGlobalOrImport){var n,r=e.nextSibling||(null===(n=e.parentLink)||void 0===n?void 0:n.nextSibling)||e.enclosingParagraph.firstLink;return U(r.enclosingParagraph.path,r)}if(e.nextSibling&&!e.nextSibling.equals(e))return U(e.nextSibling.enclosingParagraph.path,e.nextSibling);if(e.lastSibling.equals(e)){var a=function e(t){return t.parentLink&&t.parentLink.isLocal?t.parentLink.nextSibling?t.parentLink.nextSibling:e(t.parentLink):t.firstSibling}(e);return U(a.paragraphPathWhenSelected,a)}}},Q={37:"left",39:"right",38:"up",40:"down",71:"g",72:"h",75:"k",74:"j",76:"l",186:";",90:"z",68:"d",13:"enter",9:"tab",27:"escape",192:"`",49:"1",50:"2",51:"3",52:"4",53:"5"};window.addEventListener("keydown",(function(e){var t=(e.metaKey?"meta-":"")+(e.ctrlKey?"ctrl-":"")+(e.altKey?"alt-":"")+(e.shiftKey?"shift-":""),n=Q[e.keyCode],r=t+n;["tab","down","up"].includes(n)&&e.preventDefault(),x.selection?(Z[r]||function(){})():Z[r]&&U(_.current,x.selectALink())})),"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.addEventListener("popstate",(function(e){var t,n=x.selectionPresentInEvent(e)?new x(e.state):null;try{n.element}catch(e){n=null}t=P.current.path.rootTopicPath.equals(_.current.rootTopicPath)?"smooth":"auto",U(_.currentOrDefault,n||x.sessionSelection,{scrollStyle:t})})),U(_.currentOrDefault,x.priorSelection,{scrollStyle:"auto"})})()})();
//# sourceMappingURL=canopy.js.map