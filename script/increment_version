#!/bin/bash

# Extract current version
current_version=$(jq -r '.version' package.json)
echo "Current version: $current_version"

# Break the version number into an array (major, minor, patch)
IFS='.' read -ra ADDR <<< "$current_version"
major=${ADDR[0]}
minor=${ADDR[1]}
patch=${ADDR[2]}

# Remove leading zeros if present
patch=$(echo $patch | sed 's/^0*//')

# Increment the patch version
((patch++))

# Ensure patch has a leading zero if it is less than 10
if [ $patch -lt 10 ]; then
    patch="0$patch"
fi

# New version
new_version="$major.$minor.$patch"
echo "New version: $new_version"

# Update package.json with the new version
jq --arg new_version "$new_version" '.version=$new_version' package.json > temp.json && mv temp.json package.json

# Amend the last commit and add the new version tag
git add package.json
git commit --amend --no-edit
git tag -a "$new_version" -m "$new_version"

echo "Updated to version $new_version and tagged commit."
